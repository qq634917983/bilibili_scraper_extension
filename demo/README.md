# Bilibili 视频循环播放器

一个Chrome浏览器扩展，用于自动循环播放Bilibili视频列表，支持乱序播放和自定义等待时间。

## 功能特性

- 🎬 **自动循环播放**: 自动跳转到播放列表中的下一个视频
- 🔀 **乱序播放**: 随机打乱视频播放顺序
- ⏱️ **自定义等待时间**: 支持设置随机等待时间范围
- 📊 **实时倒计时**: 显示下一个视频的倒计时
- 💾 **状态持久化**: 关闭弹窗后循环继续运行
- 🎨 **现代化UI**: 美观的用户界面设计

## 项目结构

```
bilibili_scraper_extension/
├── manifest.json          # 扩展配置文件
├── popup.html             # 弹窗界面
├── popup.js               # 弹窗脚本（仅负责初始化）
├── ui-manager.js          # UI管理器（负责所有UI操作）
├── background.js          # 后台脚本（负责循环播放逻辑）
├── content-script.js      # 内容脚本（负责数据抓取）
└── README.md              # 项目说明文档
```

## 架构设计

### 1. Background Script (`background.js`)
- **职责**: 循环播放逻辑的核心
- **功能**:
  - 管理循环播放状态
  - 处理视频跳转
  - 倒计时管理
  - 状态持久化
  - 消息通信处理

### 2. UI Manager (`ui-manager.js`)
- **职责**: 所有UI相关的操作
- **功能**:
  - 按钮事件处理
  - 表格数据展示
  - 状态更新
  - 与background script通信

### 3. Content Script (`content-script.js`)
- **职责**: 从Bilibili页面抓取视频数据
- **功能**:
  - 解析视频信息
  - 获取播放列表
  - 提取视频时长
  - 数据格式化

### 4. Popup Script (`popup.js`)
- **职责**: 弹窗初始化和资源管理
- **功能**:
  - 初始化UI管理器
  - 错误处理
  - 资源清理

## 消息通信机制

### Popup ↔ Background
- `START_LOOP`: 开始循环播放
- `STOP_LOOP`: 停止循环播放
- `UPDATE_DATA`: 更新视频数据
- `SHUFFLE_DATA`: 乱序排列视频
- `GET_STATE`: 获取当前状态
- `UPDATE_RANDOM_RANGE`: 更新随机范围

### Popup ↔ Content Script
- `REQUEST_SCRAPER_DATA`: 请求抓取视频数据

## 使用方法

1. **安装扩展**: 在Chrome中加载解压的扩展
2. **打开Bilibili**: 访问任意Bilibili视频页面
3. **点击扩展图标**: 打开控制面板
4. **刷新数据**: 点击"刷新数据"获取视频列表
5. **设置参数**: 调整随机范围等参数
6. **开始循环**: 点击"开始循环"开始自动播放

## 技术特点

- **模块化设计**: 各组件职责清晰，易于维护
- **消息驱动**: 通过Chrome扩展API进行组件间通信
- **状态管理**: 完整的状态保存和恢复机制
- **错误处理**: 完善的错误处理和用户反馈
- **响应式UI**: 现代化的用户界面设计

## 开发说明

### 添加新功能
1. 在相应的模块中添加功能代码
2. 定义消息类型和数据结构
3. 更新UI界面（如需要）
4. 测试功能完整性

### 调试方法
1. 打开Chrome开发者工具
2. 查看Console日志输出
3. 检查background script日志
4. 验证消息通信

## 注意事项

- 确保在Bilibili视频页面上使用
- 循环播放期间不要关闭浏览器
- 建议设置合理的随机范围避免过于频繁的跳转
- 如遇到问题，请检查Console日志

## 更新日志

### v1.0
- 重构项目架构，分离UI和业务逻辑
- 实现background script持久化循环
- 优化用户界面设计
- 完善错误处理机制 